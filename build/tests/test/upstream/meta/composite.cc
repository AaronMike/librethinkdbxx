// auto-generated by yaml_to_cxx.py from test/upstream/meta/composite.yaml
#include "testlib.h"
void test_upstream_meta_composite() {
    enter_section("test_upstream_meta_composite: Tests meta operations in composite queries");
    TEST_EQ(R::db_drop("test").run(*conn), (partial(R::Object{{"dbs_dropped",1}})));
    TEST_EQ(R::expr(R::array(1, 2, 3)).for_each(R::db_create(R::expr("db_") + R::row.coerce_to("string"))).run(*conn), (R::Object{{"dbs_created",3}, {"config_changes",arrlen(3)}}));
    TEST_EQ(R::db_list().set_difference(R::array("rethinkdb")).for_each([=](R::Var db_name){ return R::expr(R::array(1, 2, 3)).for_each([=](R::Var i){ return R::db(*db_name).table_create(R::expr("tbl_") + (*i).coerce_to("string")); }); }).run(*conn), (partial(R::Object{{"tables_created",9}})));
    TEST_EQ(R::db_list().set_difference(R::array("rethinkdb")).for_each(R::db_drop(R::row)).run(*conn), (partial(R::Object{{"dbs_dropped",3}, {"tables_dropped",9}})));
    TEST_EQ(R::db_create("test").run(*conn), (partial(R::Object{{"dbs_created",1}})));
    exit_section();
}
