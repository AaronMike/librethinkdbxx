// auto-generated by yaml_to_cxx.py from test/upstream/regression/2838.yaml
#include "testlib.h"
void test_upstream_regression_2838() {
    enter_section("test_upstream_regression_2838: Test that return_changes fails gracefully.");
    temp_table tbl_table;
    R::Query tbl = tbl_table.table();
    TEST_EQ(tbl.insert(R::range(1, 100).map([=](R::Var i){ return R::object("result", *i); })).pluck("first_error", "inserted").run(*conn), (R::Object{{"inserted",99}}));
    TEST_EQ(tbl.update(R::object("foo", "bar"), R::OptArgs{{"return_changes", R::expr(true)}})["changes"].count().run(*conn), (40));
    TEST_EQ(tbl.update(R::object("foo", "quux"), R::OptArgs{{"return_changes", R::expr(true)}})["warnings"].run(*conn), (R::Array{"Too many changes, array truncated to 40."}));
    exit_section();
}
