// auto-generated by yaml_to_cxx.py from test/upstream/regression/2838.py.yaml
#include "testlib.h"
void test_upstream_regression_2838() {
    enter_section("test_upstream_regression_2838: Test that return_changes fails gracefully.");
    temp_table tbl_table;
    R::Query tbl = tbl_table.table();
    TEST_EQ(maybe_run(tbl.insert(R::range(1, 100).map([=](R::Var i){ return R::object("result", *i); })).pluck("first_error", "inserted"), *conn), (R::Object{{"inserted", 99}}));
    TEST_EQ(maybe_run(tbl.update(R::object("foo", "bar"), R::OptArgs{{"return_changes", R::expr(true)}})["changes"].count(), *conn, R::optargs("array_limit", 40)), (40));
    TEST_EQ(maybe_run(tbl.update(R::object("foo", "quux"), R::OptArgs{{"return_changes", R::expr(true)}})["warnings"], *conn, R::optargs("array_limit", 40)), (R::Array{"Too many changes, array truncated to 40."}));
    exit_section();
}
